
# coding: utf-8

# In[ ]:

import requests,time
import json,csv,os.path,sys
 #下面三個要更改
csrf = sys.argv[2]
secretToken = sys.argv[3]

cookie = '_gat=1; PHPSESSID=mlj8um978k8o4ek74332oqif52; 2bd8f60281051886518bc3f76c3bc3b8=5d32d32f10c525d14bb381658b97c2caa402e483a%3A4%3A%7Bi%3A0%3Bs%3A5%3A%2237616%22%3Bi%3A1%3Bs%3A9%3A%22%E7%93%9C%E7%93%9C%E7%93%9C%22%3Bi%3A2%3Bi%3A2592000%3Bi%3A3%3Ba%3A1%3A%7Bs%3A13%3A%22lastLoginTime%22%3Bi%3A1435159722%3B%7D%7D; _ga=GA1.2.1489814873.1435159714'


dateList=sys.argv[1]
payload = {
'LoginForm[email]': 'zero11911@gmail.com',
'LoginForm[password]':'123456', 
'LoginForm[rememberMe]':'0', 
'LoginForm[rememberMe]':'1', 
'ajax':'login-form'
}

rs = requests.session()
res  = rs.post('https://www.nvesto.com/user/login', data = payload)
res.encoding='utf-8'
#print res.text.encode('utf-8')
 

 
header = {
'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8',
'Cookie':cookie,
'Host':'www.nvesto.com',
'Origin':'https://www.nvesto.com',
'Referer':'https://www.nvesto.com/tpe/2498/majorForce',
'User-Agent':'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.81 Safari/537.36',
'X-Requested-With':'XMLHttpRequest'
}

#dateList.reverse()
date=dateList
if not os.path.exists('Nevsto_stock/'+date):
    os.makedirs('Nevsto_stock/'+date)
print 'start: '+date
   
with open('allComList.csv', 'rb') as csvfile:
    reader = csv.reader(csvfile)
    for row in reader:            
        sid= row[0]
        name=row[1]
        #print row[0],row[1]
        txtname = sid+'.txt'
        filename='Nevsto_stock/'+date+'/'+sid+'.txt'
        #print os.path.isfile(filename)
        if(os.path.isfile(filename)):
            print txtname+"is exist"
            continue
        print "start "+filename
        payload2 = {
            'fromdate':date,
            'todate':date,
            'view':'detail',
             'csrf':csrf,
            'secretToken':secretToken
            }
        res2 = rs.post('https://www.nvesto.com/tpe/'+sid+'/majorforce/ajaxGetData', data = payload2, headers = header)
        res2.encoding='utf-8'
        #print res2.text
        jd = json.loads(res2.text)
        fid = open('Nevsto_stock/'+date+'/'+sid+'.txt','w')
            
        fid.write(res2.text)
        fid.close()
        time.sleep(1)
            
print "END"            
#print jd['data']['sell'][0]['name']


# In[11]:

dateList=["2013-07-02","2013-07-03","2013-07-04","2013-07-05","2013-07-08","2013-07-09","2013-07-10","2013-07-11","2013-07-12","2013-07-15","2013-07-16","2013-07-17","2013-07-18","2013-07-19","2013-07-22","2013-07-23","2013-07-24","2013-07-25","2013-07-26","2013-07-29","2013-07-30","2013-07-31","2013-08-01","2013-08-02","2013-08-05","2013-08-06","2013-08-07","2013-08-08","2013-08-09","2013-08-12","2013-08-13","2013-08-14","2013-08-15","2013-08-16","2013-08-19","2013-08-20","2013-08-22","2013-08-23","2013-08-26","2013-08-27","2013-08-28","2013-08-29","2013-08-30","2013-09-02","2013-09-03","2013-09-04","2013-09-05","2013-09-06","2013-09-09","2013-09-10","2013-09-11","2013-09-12","2013-09-13","2013-09-14","2013-09-16","2013-09-17","2013-09-18","2013-09-23","2013-09-24","2013-09-25","2013-09-26","2013-09-27","2013-09-30","2013-10-01","2013-10-02","2013-10-03","2013-10-04","2013-10-07","2013-10-08","2013-10-09","2013-10-11","2013-10-14","2013-10-15","2013-10-16","2013-10-17","2013-10-18","2013-10-21","2013-10-22","2013-10-23","2013-10-24","2013-10-25","2013-10-28","2013-10-29","2013-10-30","2013-10-31","2013-11-01","2013-11-04","2013-11-05","2013-11-06","2013-11-07","2013-11-08","2013-11-11","2013-11-12","2013-11-13","2013-11-14","2013-11-15","2013-11-18","2013-11-19","2013-11-20","2013-11-21","2013-11-22","2013-11-25","2013-11-26","2013-11-27","2013-11-28","2013-11-29","2013-12-02","2013-12-03","2013-12-04","2013-12-05","2013-12-06","2013-12-09","2013-12-10","2013-12-11","2013-12-12","2013-12-13","2013-12-16","2013-12-17","2013-12-18","2013-12-19","2013-12-20","2013-12-23","2013-12-24","2013-12-25","2013-12-26","2013-12-27","2013-12-30","2013-12-31","2014-01-02","2014-01-03","2014-01-06","2014-01-07","2014-01-08","2014-01-09","2014-01-10","2014-01-13","2014-01-14","2014-01-15","2014-01-16","2014-01-17","2014-01-20","2014-01-21","2014-01-22","2014-01-23","2014-01-24","2014-01-27","2014-02-05","2014-02-06","2014-02-07","2014-02-10","2014-02-11","2014-02-12","2014-02-13","2014-02-14","2014-02-17","2014-02-18","2014-02-19","2014-02-20","2014-02-21","2014-02-24","2014-02-25","2014-02-26","2014-02-27","2014-03-03","2014-03-04","2014-03-05","2014-03-06","2014-03-07","2014-03-10","2014-03-11","2014-03-12","2014-03-13","2014-03-14","2014-03-17","2014-03-18","2014-03-19","2014-03-20","2014-03-21","2014-03-24","2014-03-25","2014-03-26","2014-03-27","2014-03-28","2014-03-31","2014-04-01","2014-04-02","2014-04-03","2014-04-07","2014-04-08","2014-04-09","2014-04-10","2014-04-11","2014-04-14","2014-04-15","2014-04-16","2014-04-17","2014-04-18","2014-04-21","2014-04-22","2014-04-23","2014-04-24","2014-04-25","2014-04-28","2014-04-29","2014-04-30","2014-05-02","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-12","2014-05-13","2014-05-14","2014-05-15","2014-05-16","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-06-03","2014-06-04","2014-06-05","2014-06-06","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-21","2014-07-22","2014-07-24","2014-07-25","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-09-01","2014-09-02","2014-09-04","2014-09-15","2014-09-16","2014-09-24","2014-09-25","2014-09-29","2014-09-30","2014-10-02","2014-10-08","2014-10-09","2014-10-15","2014-10-16","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28"]
dateList.reverse()
print dateList[0]


# In[16]:

dateList=["2014-11-27"]
#dateList.reverse()
for i in range(0):
    
    print date


# In[ ]:



